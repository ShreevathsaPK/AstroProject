<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AstroProject</title>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#667eea,#764ba2);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    background: #fff;
    width: 420px;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

h1, h2 {
    text-align: center;
    margin-bottom: 15px;
}

label {
    font-weight: bold;
    margin-top: 10px;
    display: block;
}

input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

button {
    background: #667eea;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border: none;
}

button:hover {
    background: #5568d3;
}

.row {
    display: flex;
    gap: 10px;
}

.message {
    margin-top: 10px;
    padding: 10px;
    display: none;
    text-align: center;
    border-radius: 5px;
}

.message.success { background: #d4edda; color: #155724; display:block; }
.message.error   { background: #f8d7da; color: #721c24; display:block; }

#tokenBox {
    display:none;
    background:#f9f9f9;
    padding:10px;
    margin-top:10px;
    word-break: break-all;
    font-size: 12px;
}

#querySection {
    display:none;
    margin-top: 20px;
    border-top: 2px solid #ddd;
    padding-top: 15px;
}

.query-card {
    background:#f5f5f5;
    padding:10px;
    margin-top:10px;
    border-radius:6px;
}

#queryResult {
    margin-top:10px;
    background:#fff;
    padding:10px;
    border-radius:5px;
    font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸŒŸ AstroProject</h1>

<!-- AUTH -->
<label>Username</label>
<input id="username">

<label>Password</label>
<input type="password" id="password">

<div class="row" style="margin-top:12px;">
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
</div>

<div id="msg" class="message"></div>

<div id="tokenBox"></div>

<!-- QUERY SECTION -->
<div id="querySection">

<h2>Astrology Queries</h2>

<div class="query-card">
    <b>Query 1: Planet in House / Sign</b>
    <input id="q1Planet" placeholder="Planet (Mars)">
    <input id="q1House" placeholder="House (1)">
    <input id="q1Sign" placeholder="Sign (Aries)">
    <button onclick="q1()">Run</button>
</div>

<div class="query-card">
    <b>Query 2: Retrograde Planet</b>
    <input id="q2Planet" placeholder="Planet (Mercury)">
    <button onclick="q2()">Run</button>
</div>

<div class="query-card">
    <b>Query 3: Same Sign / House</b>
    <input id="q3Planets" placeholder="Planets (Mars,Venus)">
    <input id="q3Sign" placeholder="Sign (Aries)">
    <input id="q3House" placeholder="House (5)">
    <select id="q3Mode">
        <option value="1">Same Sign</option>
        <option value="2">Same House</option>
    </select>
    <button onclick="q3()">Run</button>
</div>

<div class="query-card">
    <b>Query 4: Xth Lord in Yth House</b>
    <input id="q4X" placeholder="X (House)">
    <input id="q4Y" placeholder="Y (House)">
    <button onclick="q4()">Run</button>
</div>

<div class="query-card">
    <b>Query 5: Planet Conjunction</b>
    <input id="q5Planets" placeholder="Planets (Mars,Jupiter)">
    <button onclick="q5()">Run</button>
</div>

<div id="queryResult"></div>
</div>

</div>

<script>
const API = window.location.origin;
let token = null;

function show(msg, type) {
    const m = document.getElementById("msg");
    m.textContent = msg;
    m.className = "message " + type;
}

async function signup() {
    const u = username.value, p = password.value;
    if(!u||!p) return show("Username & password required","error");

    const r = await fetch(`${API}/signup`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({username:u,password:p})
    });
    const d = await r.json();
    r.ok ? show("User created. Please login.","success") : show(d.error,"error");
}

async function login() {
    const r = await fetch(`${API}/login`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({username:username.value,password:password.value})
    });
    const d = await r.json();
    if(!r.ok) return show(d.error,"error");

    token = d.token;
    tokenBox.style.display="block";
    tokenBox.textContent = token;
    querySection.style.display="block";
    show("Login successful","success");
}

async function call(endpoint, params) {
    const r = await fetch(`${API}/${endpoint}?${params}`,{
        headers:{Authorization:`Bearer ${token}`}
    });
    queryResult.textContent = await r.text();
}

function q1() {
    let p=`planet=${q1Planet.value}`;
    if(q1House.value) p+=`&house=${q1House.value}`;
    if(q1Sign.value) p+=`&sign=${q1Sign.value}`;
    call("query1",p);
}
function q2(){ call("query2",`planet=${q2Planet.value}`); }
function q3(){
    let p=`planets=${q3Planets.value}&mode=${q3Mode.value}`;
    if(q3Sign.value) p+=`&sign=${q3Sign.value}`;
    if(q3House.value) p+=`&house=${q3House.value}`;
    call("query3",p);
}
function q4(){ call("query4",`x=${q4X.value}&y=${q4Y.value}`); }
function q5(){ call("query5",`planets=${q5Planets.value}`); }
</script>
</body>
</html>
